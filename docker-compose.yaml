services:
  desa-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: desa-agent
    restart: unless-stopped
    ports:
      - "${GRPC_PORT:-50051}:50051"
    env_file:
      - .env
    volumes:
      - badger-data:/app/data
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "50051"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
  openldap:
    image: osixia/openldap:1.5.0
    container_name: openldap
    hostname: openldap
    environment:
      - LDAP_ORGANISATION=Desa Inc
      - LDAP_DOMAIN=desaidentity.com
      - LDAP_ADMIN_PASSWORD=password
      - LDAP_TLS=false
    ports:
      - "389:389"
    volumes:
      - ./openldap-test/data:/var/lib/ldap
      - ./openldap-test/config:/etc/ldap/slapd.d
      - ./openldap-test/ldifs:/container/service/slapd/assets/config/bootstrap/ldif/custom:ro
    command: --copy-service
volumes:
  badger-data:
    driver: local

